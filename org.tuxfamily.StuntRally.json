{
    "app-id": "org.tuxfamily.StuntRally",
    "runtime": "org.freedesktop.Platform",
    "runtime-version": "24.08",
    "sdk": "org.freedesktop.Sdk",
    "finish-args": [
        "--device=all",
        "--share=ipc",
        "--share=network",
        "--socket=x11",
        "--socket=pulseaudio"
    ],
    "command": "stuntrally3",
    "rename-desktop-file": "stuntrally3.desktop",
    "rename-icon": "stuntrally",
    "cleanup": [
        "/include",
        "/lib/pkgconfig",
        "/share/aclocal",
        "/share/doc",
        "/share/man",
        "*.la", "*.a"
    ],
    "modules": [
        "shared-modules/glu/glu-9.json",
        {
            "name": "libXmu",
            "sources": [
                {
                    "type": "archive",
                    "url": "https://www.x.org/releases/individual/lib/libXmu-1.1.4.tar.gz",
                    "sha256": "3091d711cdc1d8ea0f545a13b90d1464c3c3ab64778fd121f0d789b277a80289"
                }
            ]
        },
        {
            "name": "libXaw",
            "sources": [
                {
                    "type": "archive",
                    "url": "https://www.x.org/releases/individual/lib/libXaw-1.0.16.tar.gz",
                    "sha256": "012f90adf8739f2f023d63a5fee1528949cf2aba92ef7ac1abcfc2ae9cf28798"
                }
            ]
        },
        {
            "name": "pcre",
            "config-opts": [
                "--enable-unicode-properties"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "http://prdownloads.sourceforge.net/pcre/pcre-8.45.tar.bz2",
                    "sha256": "4dae6fdcd2bb0bb6c37b5f97c33c2be954da743985369cddac3546e3218bffb8"
                }
            ]
        },
        {
            "name": "SWIG",
            "config-opts": [
                "--without-boost",
                "--without-alllang"
            ],
            "cleanup": [
                "/bin",
                "/share/swig"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://prdownloads.sourceforge.net/swig/swig-4.3.0.tar.gz",
                    "sha256": "f7203ef796f61af986c70c05816236cbd0d31b7aa9631e5ab53020ab7804aa9e"
                }
            ]
        },
        {
            "name": "zlib",
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/madler/zlib/releases/download/v1.3.1/zlib-1.3.1.tar.gz",
                    "sha256": "9a93b2b7dfdac77ceba5a558a580e74667dd6fede4585b91eefb60f03b72df23"
                }
            ]
        },
        {
            "name": "zziplib",
            "buildsystem": "cmake",
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/gdraheim/zziplib/archive/v0.13.72.tar.gz",
                    "sha256": "93ef44bf1f1ea24fc66080426a469df82fa631d13ca3b2e4abaeab89538518dc"
                }
            ]
        },
        {
            "name": "FreeImage",
            "no-autogen": true,
            "build-options": {
                "cflags": "-std=gnu89",
                "cxxflags": "-Wno-narrowing -std=c++14"
            },
            "sources": [
                {
                    "type": "archive",
                    "url": "http://downloads.sourceforge.net/freeimage/FreeImage3180.zip",
                    "sha256": "f41379682f9ada94ea7b34fe86bf9ee00935a3147be41b6569c9605a53e438fd"
                },
                {
                    "type": "patch",
                    "path": "freeimage.patch"
                }
            ]
        },
        {
            "name": "Boost",
            "buildsystem": "simple",
            "sources": [
                {
                    "type": "archive",
                    "url": "https://sourceforge.net/projects/boost/files/boost/1.86.0/boost_1_86_0.tar.bz2",
                    "sha256": "1bed88e40401b2cb7a1f76d4bab499e352fa4d0c5f31c0dbae64e24d34d7513b"
                }
            ],
            "build-commands": [
                "./bootstrap.sh --prefix=/app --with-libraries=system,filesystem,thread,wave",
                "./b2 install variant=release link=shared runtime-link=shared -j $FLATPAK_BUILDER_N_JOBS"
            ]
        },
        {
            "name": "OIS",
            "buildsystem": "cmake",
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/wgois/OIS/archive/v1.5.1.tar.gz",
                    "sha256": "614f6ef6d69cf6d84f1b50efff46a6c1acce426933e5f0dcf29862ea8332af73"
                }
            ]
        },
        {
            "name": "pugixml",
            "buildsystem": "cmake",
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/zeux/pugixml/releases/download/v1.14/pugixml-1.14.tar.gz",
                    "sha256": "2f10e276870c64b1db6809050a75e11a897a8d7456c4be5c6b2e35a11168a015"
                }
            ]
        },
        {
            "name": "rapidjson",
            "buildsystem": "cmake-ninja",
            "config-opts": [
                "-DCMAKE_BUILD_TYPE=Release",
                "-DRAPIDJSON_BUILD_DOC=OFF",
                "-DRAPIDJSON_BUILD_EXAMPLES=OFF",
                "-DRAPIDJSON_BUILD_TESTS=OFF",
                "-DRAPIDJSON_BUILD_THIRDPARTY_GTEST=OFF"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/Tencent/rapidjson/archive/v1.1.0.tar.gz",
                    "sha256": "bf7ced29704a1e696fbccf2a2b4ea068e7774fa37f6d7dd4039d0787f8bed98e"
                },
                {
                    "type": "patch",
                    "path": "rapidjson-gcc14.patch"
                }
            ]
        },
        {
            "name": "OGRE",
            "buildsystem": "cmake-ninja",
            "config-opts": [
                "-DCMAKE_BUILD_TYPE=Release",
                "-DOGRE_BUILD_COMPONENT_PLANAR_REFLECTIONS=1",
                "-DOGRE_CONFIG_THREAD_PROVIDER=0",
                "-DOGRE_CONFIG_THREADS=0",
                "-DOGRE_BUILD_SAMPLES2=1",
                "-DOGRE_BUILD_TESTS=0"
            ],
            "build-options": {
                "cxxflags": "-L/app/lib -lboost_system -lboost_thread",
                "ldflags": "-L/app/lib -lboost_system -lboost_thread"
            },
            "sources": [
                {
                    "type": "git",
                    "url": "https://github.com/OGRECave/ogre-next.git",
                    "commit": "75643c3997f5b6d2aa1d7bd8400b9be6736d9908"
                }
            ]
        },
        {
            "name": "Bullet",
            "buildsystem": "cmake",
            "config-opts": [
                "-DBUILD_SHARED_LIBS=ON",
                "-DINSTALL_EXTRA_LIBS=ON",
                "-DBUILD_CPU_DEMOS=OFF"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/bulletphysics/bullet3/archive/refs/tags/3.25.tar.gz",
                    "sha256": "c45afb6399e3f68036ddb641c6bf6f552bf332d5ab6be62f7e6c54eda05ceb77"
                }
            ]
        },
        {
            "name": "MyGUI",
            "buildsystem": "cmake-ninja",
            "config-opts": [
                "-DCMAKE_BUILD_TYPE=Release",
                "-DMYGUI_BUILD_DEMOS=OFF"
            ],
            "build-options": {
                "cxxflags": "-L/app/lib -lboost_system",
                "ldflags": "-L/app/lib -lboost_system"
            },
            "sources": [
                {
                    "type": "git",
                    "url": "https://github.com/cryham/mygui-next.git",
                    "commit": "a1490ffe01d503c31a00d8277007ffcb27a4258e"
                }
            ]
        },
        {
            "name": "ENet",
            "sources": [
                {
                    "type": "archive",
                    "url": "http://enet.bespin.org/download/enet-1.3.18.tar.gz",
                    "sha256": "2a8a0c5360d68bb4fcd11f2e4c47c69976e8d2c85b109dd7d60b1181a4f85d36"
                }
            ]
        },
        {
            "name": "tinyxml",
            "sources": [
                {
                    "type": "archive",
                    "url": "http://sources.buildroot.net/tinyxml/tinyxml-2.6.2_2.tar.gz",
                    "sha256": "8164c9ad48b9028667768a584d62f7760cfbfb90d0dd6214ad174403058da10c"
                },
                {
                    "type": "script",
                    "dest-filename": "autogen.sh",
                    "commands": [
                        "autoreconf -vfi"
                    ]
                }
            ]
        },
        {
            "name": "tinyxml2",
            "buildsystem": "cmake-ninja",
            "build-options": {
                "cflags": "-fPIC",
                "cxxflags": "-fPIC"
            },
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/leethomason/tinyxml2/archive/refs/tags/10.0.0.tar.gz",
                    "sha256": "3bdf15128ba16686e69bce256cc468e76c7b94ff2c7f391cc5ec09e40bff3839"
                }
            ]
        },
        {
            "name": "stuntrally",
            "buildsystem": "cmake-ninja",
            "builddir": true,
            "build-options": {
                "cxxflags": "-fpermissive -std=c++14 -Wno-deprecated-declarations"
            },
            "config-opts": [
                "-DBUILD_TRANSL_TOOL=OFF",
                "-DCMAKE_BUILD_TYPE=Release"
            ],
            "sources": [
                {
                    "type": "git",
                    "url": "https://github.com/stuntrally/stuntrally3.git",
                    "commit": "31509971a2eac670b58005a6a245d269573e4083"
                },
                {
                    "type": "file",
                    "path": "org.tuxfamily.StuntRally.metainfo.xml"
                },
                {
                    "type": "patch",
                    "path": "install-desktop-files.patch"
                }
            ],
            "post-install": [
                "install -Dm644 ../org.tuxfamily.StuntRally.metainfo.xml /app/share/metainfo/org.tuxfamily.StuntRally.metainfo.xml",
                "mv /app/share/icons/hicolor/512x512/apps/sr-editor.png /app/share/icons/hicolor/512x512/apps/org.tuxfamily.StuntRally.Editor.png",
                "sed -i 's:Icon=sr-editor:Icon=org.tuxfamily.StuntRally.Editor:' /app/share/applications/sr-editor3.desktop",
                "mv /app/share/applications/sr-editor3.desktop /app/share/applications/org.tuxfamily.StuntRally.Editor.desktop"
        ]
        },
        {
            "name": "stuntrally-data",
            "buildsystem": "simple",
            "sources": [
                {
                    "type": "git",
                    "url": "https://github.com/stuntrally/tracks3.git",
                    "commit": "2908475cbd219d5494d01b69ff19284e80eb94df"
                }
            ],
            "build-commands": [
                "mkdir -p /app/share/games/stuntrally/tracks",
                "cp -r * /app/share/games/stuntrally/tracks"
        ]
        }
    ]
}

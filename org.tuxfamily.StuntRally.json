{
    "app-id": "org.tuxfamily.StuntRally",
    "runtime": "org.freedesktop.Platform",
    "runtime-version": "21.08",
    "sdk": "org.freedesktop.Sdk",
    "finish-args": [
        "--device=all",
        "--share=ipc",
        "--share=network",
        "--socket=x11",
        "--socket=pulseaudio"
    ],
    "command": "stuntrally",
    "rename-desktop-file": "stuntrally.desktop",
    "rename-icon": "stuntrally",
    "cleanup": [
        "/include",
        "/lib/pkgconfig",
        "/share/aclocal",
        "/share/man",
        "*.la", "*.a"
    ],
    "modules": [
        "shared-modules/glu/glu-9.json",
        {
            "name": "libXmu",
            "sources": [
                {
                    "type": "archive",
                    "url": "https://www.x.org/releases/individual/lib/libXmu-1.1.3.tar.bz2",
                    "sha256": "9c343225e7c3dc0904f2122b562278da5fed639b1b5e880d25111561bac5b731"
                }
            ]
        },
        {
            "name": "libXaw",
            "sources": [
                {
                    "type": "archive",
                    "url": "https://www.x.org/releases/individual/lib/libXaw-1.0.14.tar.bz2",
                    "sha256": "76aef98ea3df92615faec28004b5ce4e5c6855e716fa16de40c32030722a6f8e"
                }
            ]
        },
        {
            "name": "SWIG",
            "config-opts": [
                "--without-boost",
                "--without-alllang"
            ],
            "cleanup": [
                "/bin",
                "/share/swig"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://prdownloads.sourceforge.net/swig/swig-4.0.2.tar.gz",
                    "sha256": "d53be9730d8d58a16bf0cbd1f8ac0c0c3e1090573168bfa151b01eb47fa906fc"
                }
            ]
        },
        {
            "name": "zlib",
            "sources": [
                {
                    "type": "archive",
                    "url": "https://zlib.net/zlib-1.2.12.tar.gz",
                    "sha256": "91844808532e5ce316b3c010929493c0244f3d37593afd6de04f71821d5136d9"
                }
            ]
        },
        {
            "name": "zziplib",
            "buildsystem": "cmake",
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/gdraheim/zziplib/archive/v0.13.72.tar.gz",
                    "sha256": "93ef44bf1f1ea24fc66080426a469df82fa631d13ca3b2e4abaeab89538518dc"
                }
            ]
        },
        {
            "name": "FreeImage",
            "no-autogen": true,
            "build-options": {
                "cxxflags": "-Wno-narrowing -std=c++14"
            },
            "sources": [
                {
                    "type": "archive",
                    "url": "http://downloads.sourceforge.net/freeimage/FreeImage3180.zip",
                    "sha256": "f41379682f9ada94ea7b34fe86bf9ee00935a3147be41b6569c9605a53e438fd"
                },
                {
                    "type": "patch",
                    "path": "freeimage.patch"
                }
            ]
        },
        {
            "name": "Boost",
            "buildsystem": "simple",
            "sources": [
                {
                    "type": "archive",
                    "url": "https://sourceforge.net/projects/boost/files/boost/1.79.0/boost_1_79_0.tar.bz2",
                    "sha256": "475d589d51a7f8b3ba2ba4eda022b170e562ca3b760ee922c146b6c65856ef39"
                }
            ],
            "build-commands": [
                "./bootstrap.sh --prefix=/app --with-libraries=system,filesystem,thread,wave",
                "./b2 install variant=release link=shared runtime-link=shared -j $FLATPAK_BUILDER_N_JOBS"
            ]
        },
        {
            "name": "OIS",
            "buildsystem": "cmake",
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/wgois/OIS/archive/v1.5.1.tar.gz",
                    "sha256": "614f6ef6d69cf6d84f1b50efff46a6c1acce426933e5f0dcf29862ea8332af73"
                }
            ]
        },
        {
            "name": "pugixml",
            "buildsystem": "cmake",
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/zeux/pugixml/releases/download/v1.12.1/pugixml-1.12.1.tar.gz",
                    "sha256": "dcf671a919cc4051210f08ffd3edf9e4247f79ad583c61577a13ee93af33afc7"
                }
            ]
        },
        {
            "name": "OGRE",
            "buildsystem": "cmake-ninja",
            "config-opts": [
                "-DOGRE_BUILD_COMPONENT_PAGING=TRUE",
                "-DOGRE_BUILD_COMPONENT_TERRAIN=TRUE",
                "-DOGRE_BUILD_PLUGIN_PFX=TRUE",
                "-DOGRE_BUILD_PLUGIN_GLSLANG=FALSE",
                "-DOGRE_BUILD_PLUGIN_ASSIMP=FALSE",
                "-DOGRE_BUILD_SAMPLES=FALSE",
                "-DOGRE_BUILD_TESTS=FALSE",
                "-DOGRE_BUILD_COMPONENT_OVERLAY_IMGUI=FALSE",
                "-DOGRE_BUILD_COMPONENT_CSHARP=FALSE",
                "-DOGRE_RESOURCEMANAGER_STRICT=0",
                "-DOGRE_NODELESS_POSITIONING=ON"
            ],
            "build-options": {
                "cxxflags": "-L/app/lib -lboost_system -lboost_thread",
                "ldflags": "-L/app/lib -lboost_system -lboost_thread"
            },
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/OGRECave/ogre/archive/v13.3.4.tar.gz",
                    "sha256": "fb809bcaf5cdf2829f8a413784d7698091fbeefd3998ac202f4993d56893d96b"
                }
            ]
        },
        {
            "name": "Bullet",
            "buildsystem": "cmake",
            "config-opts": [
                "-DBUILD_SHARED_LIBS=ON",
                "-DINSTALL_EXTRA_LIBS=ON",
                "-DBUILD_DEMOS=OFF"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/bulletphysics/bullet3/archive/3.09.tar.gz",
                    "sha256": "f2feef9322329c0571d9066fede2db0ede92b19f7f7fdf54def3b4651f02af03"
                }
            ]
        },
        {
            "name": "MyGUI",
            "buildsystem": "cmake-ninja",
            "config-opts": [
                "-DMYGUI_BUILD_DEMOS=OFF"
            ],
            "build-options": {
                "cxxflags": "-L/app/lib -lboost_system",
                "ldflags": "-L/app/lib -lboost_system"
            },
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/MyGUI/mygui/archive/MyGUI3.4.1.tar.gz",
                    "sha256": "bdf730bdeb4ad89e6b8223967db01aa5274d2b93adc2c0d6aa4842faeed4de1a"
                }
            ]
        },
        {
            "name": "ENet",
            "sources": [
                {
                    "type": "archive",
                    "url": "http://enet.bespin.org/download/enet-1.3.17.tar.gz",
                    "sha256": "a38f0f194555d558533b8b15c0c478e946310022d0ec7b34334e19e4574dcedc"
                }
            ]
        },
        {
            "name": "stuntrally",
            "buildsystem": "cmake-ninja",
            "builddir": true,
            "build-options": {
                "cxxflags": "-fpermissive"
            },
            "sources": [
                {
                    "type": "git",
                    "url": "https://github.com/stuntrally/stuntrally.git",
                    "tag": "2.6.2",
                    "commit": "5349e1601a1554d393cb192719de7ad33263195f"
                },
                {
                    "type": "file",
                    "path": "org.tuxfamily.StuntRally.appdata.xml"
                }
            ],
            "post-install": [
                "install -Dm644 ../org.tuxfamily.StuntRally.appdata.xml /app/share/appdata/org.tuxfamily.StuntRally.appdata.xml",
                "mv /app/share/icons/hicolor/64x64/apps/sr-editor.png /app/share/icons/hicolor/64x64/apps/org.tuxfamily.StuntRally.Editor.png",
                "sed -i 's:Icon=sr-editor:Icon=org.tuxfamily.StuntRally.Editor:' /app/share/applications/sr-editor.desktop",
                "mv /app/share/applications/sr-editor.desktop /app/share/applications/org.tuxfamily.StuntRally.Editor.desktop"
        ]
        },
        {
            "name": "stuntrally-data",
            "buildsystem": "simple",
            "sources": [
                {
                    "type": "git",
                    "url": "https://github.com/stuntrally/tracks.git",
                    "tag": "2.6.2",
                    "commit": "78fa3c7c6fed8fb40fad1589ee61fe86e64e6694"
                }
            ],
            "build-commands": [
                "mkdir -p /app/share/games/stuntrally/tracks",
                "cp -r * /app/share/games/stuntrally/tracks"
        ]
        }
    ]
}
